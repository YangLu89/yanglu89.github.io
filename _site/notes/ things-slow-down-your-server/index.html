<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Things Slow Down Your Server</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@HeiswayiNrird" /><meta name="twitter:title" content="Things Slow Down Your Server" /><meta name="twitter:description" content="When I worked in the backend team in BloomSky, we built our backend using Django Rest framework, and deployed the backend in Google App Engine. We used services provided by Google such as Cloud SQL..."><meta name="description" content="When I worked in the backend team in BloomSky, we built our backend using Django Rest framework, and deployed the backend in Google App Engine. We used servi..."><meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o"><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/%20things-slow-down-your-server"><link rel="alternate" type="application/atom+xml" title="Yang's Blog" href="/feed.xml" /></head><body><div class="navbar"> <a class="about" href="/about">About</a> <a class="github" href="https://github.com/YangLu89/">GitHub</a> <a class="resume" href="#">Resume</a></div><aside class="logo"> <a href="/"> <img src="http://www.gravatar.com/avatar/2b38b1b0e7e08b69379bd61582adf0c8.png?s=80" class="gravatar"> </a> <span class="logo-prompt">Back to Home</span></aside><div class="summary"><h1 class="title"> Yang Lu</h1><p class="intro"> Backend Engineer at BloomSky</p></div><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Things Slow Down Your Server</h1><time>January 27, 2016</time></div><div class="divider"></div><p>When I worked in the backend team in BloomSky, we built our backend using Django Rest framework, and deployed the backend in Google App Engine. We used services provided by Google such as Cloud SQL and Compute Engine. Everything was fine at first until we reach a point when we had 30000 users and 2000 smart weather stations with our backend. All the APIs began to suffer from periodic high latency, in some severe situation, the requests to our server began to time out.</p><p>To find out the problem with our backend, we enabled the slow log in the <br /> Cloud SQL, you can check out <a href="https://cloud.google.com/sql/docs/mysql-flags">Configuring MySQL Flags</a> to learn how to enable slow log on Cloud SQL. With slow log enabled, we found<br /> that some sql queries took 30s to finish. Why it took such a long time for <br /> a query to run, it turned out that we had a many to many table that recorded<br /> the following relationship, and we calculated the number of followers using this table. To solove the problem, we cached the number of followers which significatly reduced the burden of the database and made the latency of our APIs back to normal.</p><p>The lession learned is never do expensive calculation in database, and you can always enable slow log in SQL to find out what slow down your server.</p></article><div class="back"> <a href="/">Back</a></div></main></body></html>